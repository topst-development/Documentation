# 1. はじめに
---
Real-Time Performance Monitor (RTPM) ツールキットは、AI-Gのパフォーマンスメトリクスをリアルタイムで監視および視覚化するために設計されたPythonベースのグラフィカルアプリケーションです。AI-GボードとホストPC間を接続することで、RTPMはCPU、NPU、メモリ使用率、推論時間などの主要なパフォーマンスデータの送信と分析を容易にします。
 
RTPMは、次の2つの異なるモードで動作します。
 
**インジェクションモード (Injection Mode)**: このモードでは、ホストPCが画像データをAI-Gに送信して処理させます。AI-GはNPUを使用して推論を実行し、結果をPCに返して視覚化します。
 
**プロジェクションモード (Projection Mode)**: このモードでは、AI-Gは接続されたカメラを介して画像をキャプチャし、内部で処理して、推論結果をホストPC上のRTPMに送信します。
 
このツールキットは、AI-Gプラットフォーム上のAIアプリケーションのパフォーマンスを評価および最適化することを目指す開発者やエンジニアにとって特に有益です。システム動作に関するリアルタイムの洞察を提供し、効率的なデバッグとパフォーマンスチューニングを可能にします。
 
詳細なセットアップ手順と使用ガイドラインについては、このドキュメントの以降のセクションを参照してください。
 
<br/><br/><br/><br/>
 
# 2. Real-Time Performance Monitorツールキット
---
AI-Gから取得した画像、NPU、CPU、およびMEMのパフォーマンスは、Vision Protocolを介してPCに配信でき、結果はPC上のRTPMツールキットで確認できます。
 
<p align="center"><img src="https://raw.githubusercontent.com/topst-development/Documentation/refs/heads/main/Assets/TOPST%20AI-G/Software/NPU%20development/RTPM/1.%20%20connection%20between%20Host%20PC%20and%20TOPST%20AI%20Board%20copy.png" width="500"></p>
 
<p align="center"><strong>図 2.1 ホストPCとAI-Gボード間の接続</strong></p><br/>
 
- **RTPMのダウンロード** : <[[RTPM](https://drive.google.com/file/d/1fOZxwPKd4g43TfuG4jR8nllgtaRK2zjy/view?usp=drive_link)>
 
<br/><br/><br/>
 
## 2.1 パフォーマンスモニタリング
--- 
Real-Time Performance Monitoring Toolkit (RTPM) は、Pythonを使用して開発されたGUIベースのツールであり、PC環境でAI-Gの出力を監視し、CPU、NPU、およびメモリパフォーマンスデータを確認できます。
 
 
 
**表 2.1 RTPMのパフォーマンスデータリスト:**
 
|   No   |  パフォーマンスデータ    |                説明             |
|--------|----------------------|----------------------------------------|
| 1      | 推論時間 (Inference Time)       | 各モデルの推論時間 (ms)     |
| 2      | NPU使用率 (NPU Utilization)      | 各モデルのNPU使用率         |
| 3      | FPS                  | NPU動作に基づくFPS情報 |
| 4      | CPU                  | CPU使用率 (500 msサイクル)         |
| 5      | メモリ (Memory)               | メモリ使用率 (500 msサイクル)      |
 
 
 
<p align="center"><img src="https://raw.githubusercontent.com/topst-development/Documentation/refs/heads/main/Assets/TOPST%20AI-G/Software/NPU%20development/RTPM/2.%20RTPM%20Appliccation%20Action%20screen.png"></p>
 
<p align="center"><strong>図 2.2 RTPMアプリケーション動作画面</strong></p><br/>
<br/><br/><br/>
 
## 2.2 インジェクションモード (Injection Mode)
--- 
<p align="center"><img src="https://raw.githubusercontent.com/topst-development/Documentation/refs/heads/main/Assets/TOPST%20AI-G/Software/NPU%20development/RTPM/3.%20Injection%20Mode.png"></p>
<p align="center"><strong>図 2.3 インジェクションモード</strong></p><br/>
 
インジェクションモードは、AI-GがRTPMから画像を受信し、AI-G上のNPU推論結果をRTPMに送り返すシナリオです。
 
<br/><br/><br/>
 
## 2.3 プロジェクションモード (Projection Mode)
---
<p align="center"><img src="https://raw.githubusercontent.com/topst-development/Documentation/refs/heads/main/Assets/TOPST%20AI-G/Software/NPU%20development/RTPM/4.%20Projection%20Mode.png"></p>
<p align="center"><strong>図 2.4 プロジェクションモード</strong></p><br/>
 
プロジェクションモードは、AI-Gがカメラを介して画像を受信し、最終結果 (ボックスの合成画像) をRTPMに送信するシナリオです。
 
<br/><br/><br/>
 
## 2.4 RTPMアプリケーション起動ガイド
---
このセクションでは、ホストPC上でReal-Time Performance Monitor (RTPM) アプリケーションをセットアップするためのステップバイステップの手順を提供します。
ツールのインストール、ワークスペースの構成、およびAI-G上のNPUパフォーマンスと推論結果を監視するためのRTPMインターフェースの実行方法が含まれています。
 
<br/><br/>
 
### 2.4.1 RTPM用ツールのインストール
 
- ホストPC環境を準備します。
 
1. Visual Studio Codeをインストールします。
   * Microsoft Storeから「Visual Studio Code」を検索してインストールします。
 
<p align="center"><img src="https://raw.githubusercontent.com/topst-development/Documentation/refs/heads/main/Assets/TOPST%20AI-G/Software/NPU%20development/RTPM/5.%20Install%20Visual%20Studio%20Code.png"></p>
<p align="center"><strong>図 2.5 Visual Studio Codeのインストール</strong></p><br/>
 
2. Python 3.10をインストールします。
   * Microsoft Storeから「Python 3.10」を検索してインストールします。
 
<p align="center"><img src="https://raw.githubusercontent.com/topst-development/Documentation/refs/heads/main/Assets/TOPST%20AI-G/Software/NPU%20development/RTPM/6.%20Install%20Python3.10.png"></p>
<p align="center"><strong>図 2.6 Python 3.10のインストール</strong></p><br/>
 
<br/><br/>
 
### 2.4.2 RTPMアプリケーションを開く
 
1.  SDKディレクトリからrtpmフォルダ (\<AI-G SDK\>\rtpm) をホストPC (Windows PC) にコピーします。
 
<!-- -->
 
2.  Visual Studio Codeを開きます。
 
    1.  <strong>[Ctrl + Shift + P]</strong> を押します。
 
    2.  以下のコマンドを入力します。
         * Python: Select Interpreter
           
<p align="center"><img src="https://raw.githubusercontent.com/topst-development/Documentation/refs/heads/main/Assets/TOPST%20AI-G/Software/NPU%20development/RTPM/7.%20Select%20Interpreter.png"width="800"></p>
<p align="center"><strong>図 2.7 インタープリタの選択</strong></p><br/>
 
3.  「Python 3.10.xx」を選択します。
 
<p align="center"><img src="https://raw.githubusercontent.com/topst-development/Documentation/refs/heads/main/Assets/TOPST%20AI-G/Software/NPU%20development/RTPM/8.%20Select%20python3.10.xx.png"></p>
<p align="center"><strong>図 2.8 Python 3.10.xxの選択</strong></p><br/>
 
<!-- -->
 
4.  ワークスペースを作成し、"rtpm" ディレクトリを追加します。
 
<p align="center"><img src="https://raw.githubusercontent.com/topst-development/Documentation/refs/heads/main/Assets/TOPST%20AI-G/Software/NPU%20development/RTPM/9.%20Setting%20Workspace%20and%20add%20rtpm%20directory.png"></p>
<p align="center"><strong>図 2.9 ワークスペースの作成と "rtpm" ディレクトリの追加</strong></p><br/>
 
5.  pip3パッケージをインストールします。
 
    1.  Visual Studio Codeのターミナルを開きます。
 
    <p align="center"><img src="https://raw.githubusercontent.com/topst-development/Documentation/refs/heads/main/Assets/TOPST%20AI-G/Software/NPU%20development/RTPM/10.%20Open%20Terminal.png"></p>
    <p align="center"><strong>図 2.10 ターミナルを開く</strong></p><br/>
 
    2.  以下のコマンドを入力します。
    
        ```
         PS C:\Temp\rtpm\> pip install -r requirements.txt
        ```
<br/>
 
6.  Setting.yamlの設定を変更します。
   * 初回実行時、RTPMはSetting.yamlファイルを介してUI構造と内部動作を構成します。
 
     ```
     Injection:
         width: 1280
         height: 720
         channel: 3
     DetectTypes: [
         Cluster1, Cluster2
         ]
     Features:
         Performance: false
         dewarp: false
 
     ```
<br/>
 
<table>
<colgroup>
<col style="width: 18%" />
<col style="width: 81%" />
</colgroup>
<tbody>
<tr class="odd">
<td><strong>名前</strong></td>
<td><strong>説明</strong></td>
</tr>
<tr class="even">
<td>Projection</td>
<td>プロジェクションモードオプション</td>
</tr>
<tr class="odd">
<td>Injection</td>
<td>インジェクションモードオプション</td>
</tr>
<tr class="even">
<td>DetectTypes</td>
<td><p>DetectTypes (デフォルト: Cluster1, Cluster2) は、NPU使用率、推論時間などの</p>
<p>パフォーマンス検証のための名前です。</p>
<p>DetectTypesは、tcnnappで使用されるニューラルネットワーク名 (Yolo, SSD) で記述されます。</p></td>
</tr>
<tr class="odd">
<td>Features</td>
<td>N/A</td>
</tr>
</tbody>
</table>
 
<br/>
 
7.  RTPMを実行します。
 
    1.  ワークスペースで「main.py」を選択します。
        <p align="center"><img src="https://raw.githubusercontent.com/topst-development/Documentation/refs/heads/main/Assets/TOPST%20AI-G/Software/NPU%20development/RTPM/11.%20Select%20main.py.png"></p>
    <p align="center"><strong>図 2.11 main.pyの選択</strong></p>  <br/>
       
    2.  次に <strong>[Ctrl + F5]</strong> を押します。
 
 
        <p align="center"><img src="https://raw.githubusercontent.com/topst-development/Documentation/refs/heads/main/Assets/TOPST%20AI-G/Software/NPU%20development/RTPM/12.%20Ctrl%20+%20F5.png"></p>
    <p align="center"><strong>図 2.12 RTPM画面イメージ</strong></p><br/>
 
<br/><br/>
 
### 2.4.3 インジェクションモード (Injection Mode) の使用
 
1.  入力モードをFolder (only image) に変更します。
 
<p align="center"><img src="https://raw.githubusercontent.com/topst-development/Documentation/refs/heads/main/Assets/TOPST%20AI-G/Software/NPU%20development/RTPM/13.%20Change%20the%20Input%20Mode%20to%20Folder%20(Only%20Image).png"></p>
<p align="center"><strong>図 2.13 入力モードをFolder (only image) に変更</strong></p><br/>
 
2.  推論したい画像フォルダを選択します。
 
    画像フォルダにはサブフォルダを含めないでください。
 
<p align="center"><img src="https://raw.githubusercontent.com/topst-development/Documentation/refs/heads/main/Assets/TOPST%20AI-G/Software/NPU%20development/RTPM/14.%20Select%20the%20image%20folder.png"></p>
<p align="center"><strong>図 2.14 画像フォルダの選択</strong><br/>
 
3.  フォルダアイコンをクリックし、推論を進めたいフォルダを選択します。
 
<p align="center"><img src="https://raw.githubusercontent.com/topst-development/Documentation/refs/heads/main/Assets/TOPST%20AI-G/Software/NPU%20development/RTPM/15.%20Image%20folder%20selected%20at%20rtpm.png"></p>
<p align="center"><strong>図 2.15 推論を進めるファイルの選択</strong></p><br/>
 
4.  RTPMを開始します。
 
5.  AI-Gでtcnnappのインジェクションモードを開始します。(実行順序は結果に影響しません。)
 
    ```
    # tcnnapp -i rtpm -o rtpm
    ```
 
<br/>
 
 
<p align="center"><img src="https://raw.githubusercontent.com/topst-development/Documentation/refs/heads/main/Assets/TOPST%20AI-G/Software/NPU%20development/RTPM/16.%20Run%20Tcnnapp%20Injection%20Mode.png"></p>
<p align="center"><strong>図 2.16 tcnnappインジェクションモードの開始</strong></p><br/>
 
6.  インジェクションモードを開始します。
 
<p align="center"><img src="https://raw.githubusercontent.com/topst-development/Documentation/refs/heads/main/Assets/TOPST%20AI-G/Software/NPU%20development/RTPM/17.%20Start%20Injection%20Mode.png"></p>
<p align="center"><strong>図 2.17 インジェクションモードの開始</strong></p><br/>
 
7.  測定が完了すると、保存タイプとして「Save result file」を選択している場合、\<file_name\>\_result という名前の結果ファイルが生成されます。
 
<p align="center"><img src="https://raw.githubusercontent.com/topst-development/Documentation/refs/heads/main/Assets/TOPST%20AI-G/Software/NPU%20development/RTPM/18.%20Check%20Result%20File.png"></p>
<p align="center"><strong>図 2.18 結果ファイルの確認</strong></p>
 
<br/><br/>
 
### 2.4.4 プロジェクションモード (Projection Mode) の実行
 
1.  RTPMでCamera (EVB) モードを選択します。
 
<p align="center"><img src="https://raw.githubusercontent.com/topst-development/Documentation/refs/heads/main/Assets/TOPST%20AI-G/Software/NPU%20development/RTPM/19.%20Select%20Camera(EVB)%20for%20input%20mode.png"></p>
<p align="center"><strong>図 2.19 入力モードとしてCamera (EVB) を選択</strong></p><br/>
 
2.  RTPMを開始します。
 
3.  AI-Gでtcnnappのプロジェクションモードを開始します。
 
    ```
    # tcnnapp -i camera -o rtpm
    ```
 
<br/><br/>
 
<p align="center"><img src="https://raw.githubusercontent.com/topst-development/Documentation/refs/heads/main/Assets/TOPST%20AI-G/Software/NPU%20development/RTPM/20.%20Run%20Tcnnapp%20projection%20mode.png"></p>
<p align="center"><strong>図 2.20 tcnnappプロジェクションモードの実行</strong></p><br/>
 
4.  カメラを通してリアルタイム情報を確認できます。
 
<p align="center"><img src="https://raw.githubusercontent.com/topst-development/Documentation/refs/heads/main/Assets/TOPST%20AI-G/Software/NPU%20development/RTPM/21.%20Check%20the%20information%20in%20real%20time%20through%20the%20camera.png"></p>
<p align="center"><strong>図 2.21 カメラを通したリアルタイム情報の確認</strong></p><br/>
 
5.  Project FitSizeオプションをクリックすると、画像が拡大されます。
 
<p align="center"><img src="https://raw.githubusercontent.com/topst-development/Documentation/refs/heads/main/Assets/TOPST%20AI-G/Software/NPU%20development/RTPM/22.%20Enlarged%20Image.png"></p>
<p align="center"><strong>図 2.22 Project FitSizeによる画像の拡大</strong></p><br/>
